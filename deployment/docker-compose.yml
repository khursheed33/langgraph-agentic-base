services:
  langgraph-api:
    build:
      context: ..
      dockerfile: deployment/Dockerfile
    container_name: langgraph-agentic-base
    env_file:
      - ${ENV_FILE:-../.env}
    ports:
      - "${API_PORT:-3301}:3301"
    environment:
      # LLM Configuration
      - GROQ_API_KEY=${GROQ_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      
      # Neo4j Configuration
      - NEO4J_URI=${NEO4J_URI:-bolt://neo4j:7687}
      - NEO4J_USER=${NEO4J_USER:-neo4j}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD:-password}
      
      # API Configuration
      - API_HOST=${API_HOST:-0.0.0.0}
      - API_PORT=${API_PORT:-3301}
      
      # Logging
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      
      # Python
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    volumes:
      # Mount logs directory for persistence
      - ../logs:/app/logs
      # Mount tasks directory for persistence
      - ../tasks:/app/tasks
      # Mount config files (optional, for runtime config changes)
      - ../src/config:/app/src/config:ro
    networks:
      - langgraph-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python3", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:3301/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  langgraph-network:
    external: true

