# Chat API Fixes - Import Issues and JSON Parsing

## Summary
Fixed chat API issues causing invalid JSON responses and empty message arrays.

## Issues Found and Fixed

### 1. Incorrect Import Path in prompt_utils.py
**Problem**: Path was still using `"src/agents/{agent_name}/prompt.md"` instead of `"app/agents/{agent_name}/prompt.md"`
**Fix**: Updated path to use `app/` directory after renaming

### 2. Complex Import in Chat API
**Problem**: Chat endpoint was using complex `importlib` to import `run_workflow` from main.py
**Fix**: Updated to directly import from `app.services.workflow_service`

### 3. Supervisor JSON Parsing Error
**Problem**: Supervisor agent was outputting plain text instead of JSON, causing parsing errors
**Fix**: Fixed prompt path so supervisor gets proper JSON instructions

## Files Modified

### app/utils/prompt_utils.py
- Updated prompt file path from `"src/agents/{agent_name}/prompt.md"` to `"app/agents/{agent_name}/prompt.md"`

### app/api/v1/chat.py
- Added direct import: `from app.services.workflow_service import run_workflow`
- Removed complex `importlib` import code

## Expected Results

After these fixes:
- ✅ Chat API should return proper JSON responses
- ✅ Messages array should be populated with conversation history
- ✅ Supervisor should output valid JSON instead of plain text
- ✅ Final results should be properly formatted
- ✅ No more "Invalid json output" errors

## Testing

The fixes ensure:
- Proper import resolution after directory restructuring
- Correct workflow service integration
- Valid JSON output from supervisor agent
